"use strict";var express=require("express"),cors=require("cors"),mongoose=require("mongoose"),multer=require("multer"),ffmpeg=require("fluent-ffmpeg"),fs=require("fs"),path=require("path"),app=express();app.use(cors()),app.use(express.json());var Db=function(){mongoose.connect("mongodb://localhost:27017/videos").then(function(e){console.log("Database connected "),app.listen(PORT,function(){console.log("Server connected on ",PORT)})}).catch(function(e){console.log(e.message)})};app.use("/public",express.static(path.join(__dirname+"/public")));var PORT=8e3,storage=multer.diskStorage({destination:function(e,o,n){fs.existsSync("public")||fs.mkdirSync("public"),fs.existsSync("public/videos")||fs.mkdirSync("public/videos"),n(null,"public/videos")},filename:function(e,o,n){n(null,Date.now()+o.originalname)}}),upload=multer({storage:storage,fileFilter:function(e,o,n){var r=path.extname(o.originalname);if(".mkv"!==r&&".mp4"!==r)return n(new Error("Only videos are allowed!"));n(null,!0)}}),videoSchema=new mongoose.Schema({name:{type:String,required:!0},videos:[{type:String}]},{timestamps:!0}),VModel=mongoose.model("videos",videoSchema);app.get("/videos",function(e,r){fs.readdir("public/videos",function(e,o){if(e)r.status(500).json({message:"Error reading video directory"});else{var n=o.filter(function(e){return".mp4"===path.extname(e)});r.json({videos:n})}})}),app.post("/create",upload.single("video"),function(o){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:n=o.file.path,[240,360,480,720,1080].forEach(function(e){var o=path.join(__dirname,"public/videos","".concat(path.basename(n,path.extname(n)),"_").concat(e,"p.mp4"));ffmpeg(n).videoCodec("libx264").size("?x".concat(e)).output(o).on("end",function(){console.log("Video transcoded to ".concat(e))}).on("error",function(e){console.error("Error transcoding video: ".concat(e.message))}).run()});case 3:case"end":return e.stop()}})}),Db();
//# sourceMappingURL=server.min.js.map
